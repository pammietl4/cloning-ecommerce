# -------- Stage 1: Build/Install dependencies --------
FROM node:20-slim AS builder

WORKDIR /cart-service

COPY package.json .
# If you have a package-lock.json, copy it for reproducible builds
# COPY package-lock.json .

# Only install production dependencies in builder stage
RUN npm install --production

# -------- Stage 2: Minimal runtime --------
FROM node:20-slim

WORKDIR /cart-service

# Copy just the node_modules from builder (not dev deps, not caches)
COPY --from=builder /cart-service/node_modules ./node_modules

# Copy only app source code
COPY server.js .

USER node

EXPOSE 8001

CMD ["node", "server.js"]